
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>snakeoil.dependant_methods &mdash; snakeoil v-trunk documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '-trunk',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="snakeoil v-trunk documentation" href="../index.html" />
    <link rel="up" title="API Documentation" href="../api.html" />
    <link rel="next" title="snakeoil.descriptors" href="snakeoil.descriptors.html" />
    <link rel="prev" title="snakeoil.demandload" href="snakeoil.demandload.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="snakeoil.descriptors.html" title="snakeoil.descriptors"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="snakeoil.demandload.html" title="snakeoil.demandload"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">snakeoil v-trunk documentation</a> &raquo;</li>
          <li><a href="../api.html" accesskey="U">API Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-snakeoil.dependant_methods">
<span id="snakeoil-dependant-methods"></span><h1>snakeoil.dependant_methods<a class="headerlink" href="#module-snakeoil.dependant_methods" title="Permalink to this headline">¶</a></h1>
<p>Metaclass to inject dependencies into method calls.</p>
<p>Roughly, if you have 3 methods- that must be ran in the order of start, transfer, finish,
this metaclass enables you to force it such that if <em>finish</em> is called first,
start, than transfer, finally finish will be invoked transparently.</p>
<p>Methods involved should all require just <tt class="docutils literal"><span class="pre">self</span></tt>.</p>
<p>The main usage for this code is to enable long chains of steps to be broken
down into individual methods, and the consuming api not being required to
know the proper order of invocation for that api unless they want to.</p>
<p>Most consumers of this metaclass wind up making a <tt class="docutils literal"><span class="pre">finish</span></tt> method the final step-
via that, consuming api&#8217;s only requirement is knowing that if they invoke <tt class="docutils literal"><span class="pre">finish</span></tt>
all necessary steps will be ran in the correct order.</p>
<p>Example usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">snakeoil.dependant_methods</span> <span class="kn">import</span> <span class="n">ForcedDepends</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="gp">... </span>  <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ForcedDepends</span>
<span class="gp">... </span>  <span class="n">stage_depends</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;finish&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s">&quot;do_step1&quot;</span><span class="p">,</span> <span class="s">&quot;do_step2&quot;</span><span class="p">),</span>
<span class="gp">... </span>    <span class="s">&quot;do_step1&quot;</span><span class="p">:</span><span class="s">&quot;start&quot;</span><span class="p">,</span> <span class="s">&quot;do_step2&quot;</span><span class="p">:</span> <span class="s">&quot;start&quot;</span><span class="p">}</span>
<span class="gp">...</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;finish invoked&quot;</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">True</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">do_step1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;running step1&quot;</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">True</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">do_step2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;running step2&quot;</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">True</span>
<span class="gp">... </span>  <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;starting&quot;</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="bp">True</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
<span class="go">starting</span>
<span class="go">running step1</span>
<span class="go">running step2</span>
<span class="go">finish invoked</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># note, no output since finish has already been ran.</span>
</pre></div>
</div>
<p class="rubric">Classes</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr><td><a class="reference internal" href="#snakeoil.dependant_methods.ForcedDepends" title="snakeoil.dependant_methods.ForcedDepends"><tt class="xref py py-obj docutils literal"><span class="pre">ForcedDepends</span></tt></a></td>
<td>Metaclass forcing methods to run in a certain order.</td>
</tr>
</tbody>
</table>
<dl class="class">
<dt id="snakeoil.dependant_methods.ForcedDepends">
<em class="property">class </em><tt class="descclassname">snakeoil.dependant_methods.</tt><tt class="descname">ForcedDepends</tt><a class="reference internal" href="../_modules/snakeoil/dependant_methods.html#ForcedDepends"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#snakeoil.dependant_methods.ForcedDepends" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">type</span></tt></p>
<p>Metaclass forcing methods to run in a certain order.</p>
<p>Dependencies are controlled by the existance of a stage_depends
dict in the class namespace. Its keys are method names, values are
either a string (name of preceeding method), or list/tuple
(proceeding methods).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>stage_depends</strong> &#8211; mapping of <em>stage</em> -&gt; stages that must be ran first
Dependant stages can either be a string (single stage), or a tuple- multiple stages,
required in the order the&#8217;re specified</li>
<li><strong>__stage_step_callback__</strong> &#8211; callback accepting a single arg, the phase that just ran.
This method/callback is primarily useful for getting raw notification of stages that
have just completed- whether for notifying a user, or for debugging.</li>
<li><strong>__set_stage_state__</strong> &#8211; method accepting a sequence; the stages completed for this
instance are set to that sequence.  This should be used with extreme care; primarily
useful for resuming a sequence of stages midway through.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="snakeoil.dependant_methods.ForcedDepends.mro">
<tt class="descname">mro</tt><a class="headerlink" href="#snakeoil.dependant_methods.ForcedDepends.mro" title="Permalink to this definition">¶</a></dt>
<dd><p>mro() -&gt; list
return a type&#8217;s method resolution order</p>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="snakeoil.demandload.html"
                        title="previous chapter">snakeoil.demandload</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="snakeoil.descriptors.html"
                        title="next chapter">snakeoil.descriptors</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="snakeoil.descriptors.html" title="snakeoil.descriptors"
             >next</a> |</li>
        <li class="right" >
          <a href="snakeoil.demandload.html" title="snakeoil.demandload"
             >previous</a> |</li>
        <li><a href="../index.html">snakeoil v-trunk documentation</a> &raquo;</li>
          <li><a href="../api.html" >API Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, Brian Harring.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>